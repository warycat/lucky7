function setup(){function a(){lucky7.input.addKey(CANDLE.kSpace,function(){switch(lucky7.state){case"init":case"idle":q(),k();break;case"spinning":case"stop1":case"stop2":case"stop3":case"money":break;default:console.log("error")}})}function b(){var a=new PIXI.Sprite.fromFrame("background.png");r.addChild(a),lucky7.background=a}function c(){var a=lucky7.background,b=new PIXI.MovieClip(lucky7.reelTextures);b.animationSpeed=.5,b.x=160,b.y=131,a.addChild(b);var c=new PIXI.MovieClip(lucky7.reelTextures);c.animationSpeed=.5,c.x=410,c.y=131,a.addChild(c);var d=new PIXI.MovieClip(lucky7.reelTextures);d.animationSpeed=.5,d.x=660,d.y=131,a.addChild(d);var e=[b,c,d];lucky7.reels=e}function d(){for(var a=lucky7.background,b=[],c=0;3>c;c++){for(var d=[],e=0;3>e;e++)symbo=new PIXI.MovieClip([lucky7.symboTextures.seven0,lucky7.symboTextures.seven1]),symbo.animationSpeed=.08,symbo.x=260+250*e,symbo.y=157+110*c,1!==c&&(symbo.scale.y=.3),symbo.anchor={x:.5,y:.5},a.addChild(symbo),d[e]=symbo;b[c]=d}lucky7.symbos=b}function e(){var a=lucky7.background,b=new PIXI.Sprite.fromFrame("window.png");b.x=143,b.y=118,a.addChild(b)}function f(){for(var a=[],b=0;6>b;b++){var c=new PIXI.Texture.fromFrame("reels-"+b+".png");a[b]=c}lucky7.reelTextures=a}function g(){var a={},b=["seven0","seven1","cherry0","cherry1","lucky0","lucky1","1bar0","1bar1","2bar0","2bar1","3bar0","3bar1","blank"];for(var c in b){var d=b[c];a[d]=new PIXI.Texture.fromFrame(d+".png")}lucky7.symboTextures=a}function h(a,b){if("blank"===a)return void(this.textures=[lucky7.symboTextures.blank]);switch(this.textures=[lucky7.symboTextures[a+"0"],lucky7.symboTextures[a+"1"]],b){case"on":this.gotoAndStop(0);break;case"off":this.gotoAndStop(1);break;case"flash":this.gotoAndPlay(0)}}function i(){var a=new PIXI.Graphics;a.beginFill(0),a.drawRect(50,200,390,500),lucky7.stage.addChild(a),console.log(PIXI.BitmapText.fonts);var b=new PIXI.BitmapText("",{font:"28px LCD",align:"right"});b.x=100,b.y=461,b.mask=a;var c=new PIXI.BitmapText("",{font:"28px LCD",align:"right"});c.x=450,c.y=461,c.mask=a,lucky7.texts=[b,c],lucky7.stage.addChild(b),lucky7.stage.addChild(c)}function j(){lucky7.state="init";for(var a=["seven","seven","seven","lucky","lucky","lucky","cherry","cherry","cherry"],b=0;3>b;b++)for(var c=0;3>c;c++)h.call(lucky7.symbos[b][c],a[3*b+c],"on");for(b=0;3>b;b++)lucky7.reels[b].visible=!1;lucky7.texts[0].setText("TAP TO SPIN"),lucky7.texts[1].setText("TAP TO SPIN")}function k(){lucky7.state="spinning";for(var a=0;3>a;a++)lucky7.reels[a].visible=!0,lucky7.reels[a].gotoAndPlay(2*a);for(a=0;3>a;a++)for(var b=0;3>b;b++){lucky7.symbos[a][b].visible=!1;var c=s[(lucky7.outcome.payline[b]-a+8)%7];h.call(lucky7.symbos[a][b],c,"on")}for(a=0;3>a;a++)lucky7.reels[a].visible=!0;lucky7.texts[0].x=180,lucky7.texts[0].setText("GOOD LUCK"),lucky7.texts[0].flashSpeed=.08,lucky7.texts[0].flash=0,lucky7.texts[1].x=530,setTimeout(l,1e3)}function l(){lucky7.state="stop1",console.log("stop1"),lucky7.reels[0].visible=!1;for(var a=0;3>a;a++)for(var b=0;3>b;b++)0===b&&(lucky7.symbos[a][b].visible=!0);setTimeout(m,500)}function m(){lucky7.state="stop2",lucky7.reels[1].visible=!1;for(var a=0;3>a;a++)for(var b=0;3>b;b++)1===b&&(lucky7.symbos[a][b].visible=!0,lucky7.symbos[a][b].gotoAndStop(0));setTimeout(n,500)}function n(){lucky7.state="stop3",lucky7.reels[2].visible=!1;for(var a=0;3>a;a++)for(var b=0;3>b;b++)2===b&&(lucky7.symbos[a][b].visible=!0,lucky7.symbos[a][b].gotoAndStop(0));setTimeout(o,50)}function o(){lucky7.state="money";for(var a=0;3>a;a++)for(var b=0;3>b;b++)1===a?lucky7.symbos[a][b].gotoAndPlay(1):lucky7.symbos[a][b].gotoAndStop(1);setTimeout(p,500)}function p(){lucky7.state="idle",lucky7.texts[0].setText("TAP TO SPIN"),lucky7.texts[1].setText("TAP TO SPIN")}function q(){lucky7.outcome={win:"1000",payline:[4,5,6]}}var r=(lucky7.input,lucky7.stage),s=["seven","lucky","cherry","3bar","2bar","1bar","blank"];f(),g(),a(),b(),c(),d(),i(),e(),j()}function update(){function a(){h()}function b(){lucky7.texts[0].flash+=lucky7.texts[0].flashSpeed;var a=Math.floor(lucky7.texts[0].flash);lucky7.texts[0].visible=a%2}function c(){console.log("stop1"),b(1)}function d(){console.log("stop2"),b(2)}function e(){console.log("stop3"),b(3)}function f(){console.log("money")}function g(){h()}function h(){for(var a in lucky7.texts){var b=lucky7.texts[a];b.x=b.x-1,b.x<-200&&(b.x=500)}}switch(lucky7.state){case"init":a();break;case"spinning":b(0);break;case"stop1":c();break;case"stop2":d();break;case"stop3":e();break;case"money":f();break;case"idle":g();break;default:console.log("error")}}var CANDLE={kSpace:"kSpace",kTab:"kTab"};CANDLE.GAME=function(a,b,c){var d=this;PIXI.EventTarget.call(this),this.loader=a,this.setup=b,this.update=c,this.input=new CANDLE.INPUT,this.render=new CANDLE.RENDER(this.update,962,551),this.loader.load(),this.stage=this.render.stage,this.loader.addEventListener("onComplete",function(){d.setup(),d.render.play()})},CANDLE.INPUT=function(a,b){this.keys={},this.callbacks={},this.debug=b||!1,this.keyString=a||"",window.addEventListener("keydown",CANDLE.INPUT.prototype.keydown.bind(this)),window.addEventListener("keyup",CANDLE.INPUT.prototype.keyup.bind(this))},CANDLE.INPUT.prototype=function(){function a(a){var b=a.keyCode,c=CANDLE.INPUT.prototype.codeToChar(b);this.debug&&console.log(b,c),this.keys.hasOwnProperty(c)&&(a.preventDefault(),this.keys[c]="down",this.callbacks[c].call(this))}function b(a){var b=a.keyCode,c=String.fromCharCode(b);this.keys.hasOwnProperty(c)&&(a.preventDefault(),this.keys[c]="up")}function c(a){switch(a){case 9:return CANDLE.kTab;case 13:return CANDLE.kEnter;case 32:return CANDLE.kSpace;default:return String.fromCharCode(a)}}function d(a,b){this.keys.hasOwnProperty(a)||(this.keys[a]="up",this.callbacks[a]=b)}return{keydown:a,keyup:b,codeToChar:c,addKey:d}}(),CANDLE.RENDER=function(a,b,c){var d=this;this.render=a,this.width=b||1136,this.height=c||640,this.renderer=new PIXI.autoDetectRenderer(this.width,this.height),this.renderer.view.style.display="block",this.renderer.view.style.margin="auto",this.paused=!1,this.stage=new PIXI.Stage(15794175,!0),document.body.appendChild(this.renderer.view),CANDLE.RENDER.prototype.resize.call(this),$(window).resize(function(){CANDLE.RENDER.prototype.resize.call(d)})},CANDLE.RENDER.prototype=function(){function a(){var a=$(window).width(),b=$(window).height();b/a>640/1136?(this.renderer.view.style.width=$(window).width()+"px",this.renderer.view.style.height=$(window).width()/1136*640+"px"):(this.renderer.view.style.width=$(window).height()/640*1136+"px",this.renderer.view.style.height=$(window).height()+"px")}function b(){paused=!1,requestAnimFrame(d.bind(this))}function c(){paused=!0}function d(){paused||(this.render(),this.renderer.render(this.stage),requestAnimFrame(d.bind(this)))}return{resize:a,play:b,pause:c,animate:d}}(),CANDLE.LOADER=function(a,b){a=a||"images/";var c=_.map(b,function(b){return a+b})||[],d=new PIXI.AssetLoader(c);return d};var loader=new CANDLE.LOADER("images/",["atlas.json","lcd.xml"]),lucky7=new CANDLE.GAME(loader,setup,update);